# 変更履歴

## v1.1.0 - 2025年10月24日 - グラフ表示オプションの統一と拡張

### 変更内容

#### グラフ表示オプションの統一化
- **従来のオプション**: 相関係数の表示/非表示（二項選択）
- **新しいオプション**: 相関係数、回帰直線、なしの三択に統一
- すべてのプロット機能で一貫性のあるUIを実現

#### 相関係数表示機能
- **基本ペアプロット**: 相関係数を下三角部分に表示
- **色分けペアプロット**: 相関係数を下三角部分に表示
- **散布図**: 相関係数 `r` とp値を散布図左上に表示

#### 回帰直線表示機能（新機能）
- **基本ペアプロット**: 下三角部分に回帰直線を追加
- **色分けペアプロット**: 下三角部分に回帰直線を追加
- **散布図**: 回帰式 `y = ax + b` と `R²` を散布図左上に表示
- **色彩**: すべての回帰直線をモノクロ（黒）で統一

#### ユーザーインターフェースの改善
すべてのプロット選択時に統一されたメニューを表示：
```
追加オプション
1. 相関係数を表示
2. 回帰直線を表示
3. なし
```

### ファイル変更
- `plotters/utils.py`: 回帰直線描画関数 `regress_func()` を追加
- `plotters/basic_pairplot.py`: パラメータを `show_correlation` から `annotation_type` に変更、回帰直線対応
- `plotters/colored_pairplot.py`: パラメータを `show_correlation` から `annotation_type` に変更、回帰直線対応
- `plotters/scatter_boxplot.py`: パラメータ `annotation_type` を追加、相関係数・回帰直線表示機能を実装
- `cli.py`: すべてのプロット機能に統一されたメニューを実装

### 技術詳細

#### 相関係数・回帰直線の表示タイプ
- `"correlation"`: Pearsonの相関係数を計算・表示
- `"regression"`: 線形回帰を計算、直線を描画
- `"none"`: 何も表示しない（デフォルト）

#### 計算情報の表示
- **相関係数**: ターミナルに相関係数行列を表示（ペアプロット）
- **回帰直線**: ターミナルに回帰式と決定係数R²を表示

### 下位互換性
- **フレームワーク**: 基本的な出力形式は変更なし
- **ディレクトリ構造**: `data/` と `output/` の構造に変更なし
- **ファイル命名**: 既存のファイル命名規則を踏襲
- **注意**: 関数シグネチャが変更されたため、既存の直接呼び出しコードは修正が必要

### パフォーマンス
- 計算量の増加なし（相関係数と回帰直線は同じデータから計算）
- UIの応答性は変わらず

### 今後の拡張予定
- 複数の回帰モデルへの対応（非線形回帰など）
- グラフのスタイルカスタマイズ機能
- 統計検定結果の表示

---

## v1.0.1 - 2025年10月17日 - 白黒描画と散布図機能の拡張

### 変更内容

#### 白黒描画への統一
- **全てのプロットを白黒で描画**: 印刷・出版に適した形式に変更
- **基本ペアプロット**: 黒い点とヒストグラムで統一
- **色分けペアプロット**: 四角と丸から黒丸・白抜き丸に変更
- **箱ひげ図**: 青色から白黒（白抜き箱、黒い枠線）に変更

#### 凡例の削除
- **色分けペアプロット**: 「z=0」「z=1」などの凡例を削除
- **散布図（色分け時）**: 凡例を表示しない
- シンプルで見やすい見た目を実現

#### 散布図機能の拡張
- **箱ひげ図のオプション化**: 散布図に箱ひげ図を追加するか選択可能に
- **散布図のみの出力**: シンプルな散布図の作成が可能
- **柔軟な出力**: 
  - 散布図のみ
  - 散布図 + 箱ひげ図
  - 上記2つのどちらもz列による色分けに対応

#### ユーザビリティの向上
- メニューの説明を「散布図 + 箱ひげ図」から「散布図」に変更
- 箱ひげ図を追加するかの選択肢を追加
- ファイル命名規則を明確化（`_colored`, `_with_boxplot`など）

### ファイル変更
- `plotters/basic_pairplot.py`: 白黒描画の実装
- `plotters/colored_pairplot.py`: 黒丸・白抜き丸への変更、凡例削除
- `plotters/scatter_boxplot.py`: 箱ひげ図のオプション化、白黒描画
- `cli.py`: メニュー更新、箱ひげ図選択機能の追加
- `README.md`: ドキュメントの更新

---

## v1.0.0 - 2025年10月17日 - ライブラリ化

### 主要な変更

#### パッケージ化
- スタンドアロンスクリプトから完全なPythonパッケージへ移行
- パッケージ名: `pairplot_lib`
- CLIコマンド: `pairplot`
- `python -m pairplot_lib` での実行もサポート

#### 構造の整理とリファクタリング
- **モジュール化**: 共通機能を`core`モジュールに集約
  - `data_loader.py`: CSV読み込み、列選択などの共通処理
  - `file_utils.py`: ファイル操作ユーティリティ
- **プロッターの分離**: 各プロット機能を独立したモジュールに
  - `basic_pairplot.py`: 相関係数表示付き基本ペアプロット
  - `colored_pairplot.py`: z列による色分けペアプロット
  - `scatter_boxplot.py`: 散布図+箱ひげ図の組み合わせ
- **統一されたCLI**: メニュー方式で3つのプロットタイプを選択可能

#### 新機能
- **散布図+箱ひげ図**: 2変数の散布図と箱ひげ図を組み合わせた可視化を追加
- **対話的なメニュー**: プロットタイプを視覚的に選択可能
- **堅牢なCSV読み込み**: タブ、カンマ、空白区切りなど様々な形式に対応

#### コード品質の向上
- 冪等性の担保: 同じ入力に対して常に同じ出力
- コードの重複を排除
- 型ヒントの追加
- ドキュメント文字列の充実
- Lintエラーゼロ

#### インストールとデプロイ
- `pip install -e .` で開発モードインストール可能
- `setup.py` による標準的なパッケージング
- 最小限の依存関係（pandas, numpy, matplotlib, seaborn, scipy）

#### ドキュメント
- 包括的なREADME.mdの作成
- インストール方法、使用方法、ディレクトリ構成を明記
- 各機能の詳細な説明

### 削除されたファイル
- `pairplot2.py` → `pairplot_lib/plotters/basic_pairplot.py` へ移行
- `pairplot4.py` → `pairplot_lib/plotters/colored_pairplot.py` へ移行
- `scatter_with_boxplot.py` → `pairplot_lib/plotters/scatter_boxplot.py` へ移行
- `pairplot_research.py` → 未使用のため削除

### 下位互換性
- 出力画像の形式と品質は完全に維持
- ファイル命名規則は既存のものを踏襲
- データディレクトリ（`data/`）と出力ディレクトリ（`output/`）の構造は変更なし

---

## 2025年10月11日 - 大幅な改善

### 改善内容

#### 1. フォルダ構造の整理
- `data/` フォルダを作成: CSVファイルを一元管理
- `output/` フォルダを作成: 生成された画像ファイルの保存先

#### 2. インタラクティブなファイル選択機能
- スクリプト実行時に `data/` フォルダ内のCSVファイルを自動検出
- 番号付きの一覧を表示し、ユーザーが選択可能に
- ファイルパスを毎回編集する必要がなくなった

#### 3. 柔軟なデータ読み込み
- タブ区切り、カンマ区切りの両方に対応
- 自動でフォーマットを検出
- 数値列を自動検出し、利用可能な列を表示

#### 4. 自動ファイル命名
- 元のCSVファイル名に基づいて出力ファイル名を自動生成
- 例: `have5.csv` → `have5_pairplot.png`
- ファイル名の衝突を防ぎ、出力の追跡が容易に

#### 5. わかりやすい出力表示
- 処理状況をリアルタイムで表示
- 完了時に生成されたファイル名と保存先を明示
- エラーメッセージを改善

#### 6. pairplot4.pyの機能強化
- z列のユニークな値を自動検出
- カテゴリ数に応じて自動的に色とマーカーを割り当て
- 最大10種類のカテゴリに対応

### スクリプト別の改善

#### pairplot2.py
- 相関係数表示付きの基本的なペアプロット
- すべての数値列を自動検出して使用
- 相関係数行列をターミナルに表示

#### pairplot4.py
- z列による色分けペアプロット
- ユニークな値に応じて自動的にパレットを生成
- 多様なマーカー形状に対応

### 使用方法

1. CSVファイルを `data/` フォルダに配置
2. スクリプトを実行: `python pairplot2.py` または `python pairplot4.py`
3. 表示されたファイル一覧から番号を選択
4. 生成された画像は `output/` フォルダに保存される
5. 完了時にファイル名が表示される

### メリット

- **再利用性**: どのCSVファイルでも簡単に使用可能
- **効率性**: ファイルパスを編集する必要なし
- **明確性**: 出力ファイル名が入力ファイル名と対応
- **拡張性**: 新しいCSVファイルを追加するだけで使用可能

